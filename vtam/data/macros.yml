{% macro input_file_threshold_specific(threshold_specific) -%}
{% if not (threshold_specific is none) %}
            threshold_specific: {{threshold_specific}}{% endif %}
{%- endmacro%}

{% macro input_lfn_variant_replicate_threshold(lfn_variant_threshold, lfn_variant_replicate_threshold) -%}
{% if not (lfn_variant_replicate_threshold is none) %}
        lfn_variant_replicate_threshold: {{lfn_variant_replicate_threshold}}{% else %}
        lfn_variant_threshold: {{lfn_variant_threshold}}{% endif %}
{%- endmacro%}

{% macro rule_optimize_lfn_readcount_and_lfn_variant_replicate(lfn_variant_threshold, lfn_variant_replicate_threshold, readinfo, known_occurrences, lfn_biosample_replicate_threshold, lfn_read_count_threshold, min_replicate_number, optimize_lfn_read_count_and_lfn_variant, optimize_lfn_variant_specific, optimize_lfn_read_count_and_lfn_variant_replicate, optimize_lfn_variant_replicate_specific) -%}
{% if lfn_variant_replicate_threshold is none %}rule OptimizeLFNreadCountAndLFNvariant:
    tool: vtam.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: vtam.models.Run
            Marker: vtam.models.Marker
            Biosample: vtam.models.Biosample
            Variant: vtam.models.Variant
            VariantReadCount: vtam.models.VariantReadCount
        file:
            readinfo: {{readinfo}}
            known_occurrences: {{known_occurrences}}
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: {{optimize_lfn_read_count_and_lfn_variant}}
            optimize_lfn_variant_specific: {{optimize_lfn_variant_specific}}
    params:
        is_optimize_lfn_variant_replicate: 0
        lfn_variant_or_variant_replicate_threshold: {{lfn_variant_threshold}}
        lfn_biosample_replicate_threshold: {{lfn_biosample_replicate_threshold}}
        lfn_read_count_threshold: {{lfn_read_count_threshold}}
        min_replicate_number: {{min_replicate_number}}{% else %}rule OptimizeLFNreadCountAndLFNvariantReplicate:
    tool: vtam.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: vtam.models.Run
            Marker: vtam.models.Marker
            Biosample: vtam.models.Biosample
            Variant: vtam.models.Variant
            VariantReadCount: vtam.models.VariantReadCount
        file:
            readinfo: {{readinfo}}
            known_occurrences: {{known_occurrences}}
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: {{optimize_lfn_read_count_and_lfn_variant_replicate}}
            optimize_lfn_variant_specific: {{optimize_lfn_variant_replicate_specific}}
    params:
        is_optimize_lfn_variant_replicate: 1
        lfn_variant_or_variant_replicate_threshold: {{lfn_variant_replicate_threshold}}
        lfn_biosample_replicate_threshold: {{lfn_biosample_replicate_threshold}}
        lfn_read_count_threshold: {{lfn_read_count_threshold}}
        min_replicate_number: {{min_replicate_number}}{% endif %}
{%- endmacro%}
