rule SampleInformation:
    tool: vtam.wrapper.SampleInformation
    input:
        file:
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
    output:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Fasta: vtam.model.Fasta
            PrimerPair: vtam.model.PrimerPair
            TagPair: vtam.model.TagPair
            SampleInformation: vtam.model.SampleInformation
    params:
        fasta_dir: test/utils


rule SortReads:
    tool: vtam.wrapper.SortReads
    input:
        table:
            Fasta: vtam.model.Fasta
            SampleInformation: vtam.model.SampleInformation
            Marker: vtam.model.Marker
        file:
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
    output:
        file:
            sortreads: test/utils/sortreads.tsv
    params:
        min_id: 0.8
        minseqlength: 32
        overhang: 0


rule VariantReadCount:
    tool: vtam.wrapper.VariantReadCount
    input:
        file:
            sortreads: test/utils/sortreads.tsv
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
    output:
        table:
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
    params:
        foo: 0


rule OptimizeLFNbiosampleReplicate:
    tool: vtam.wrapper.OptimizeLFNbiosampleReplicate
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
            variant_known: test/utils/test_wopmars_runner_wopfile_optimize.py
    output:
        file:
            optimize_lfn_biosample_replicate: test/utils/optimize_lfn_biosample_replicate.tsv
    params:
      foo: 0


rule OptimizePCRerror:
    tool: vtam.wrapper.OptimizePCRerror
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
            variant_known: test/utils/test_wopmars_runner_wopfile_optimize.py
    output:
        file:
            optimize_pcr_error: test/utils/optimize_pcr_error.tsv
    params:
        foo: 0


rule OptimizeLFNreadCountAndLFNvariant:
    tool: vtam.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
            variant_known: test/utils/test_wopmars_runner_wopfile_optimize.py
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: test/utils/optimize_lfn_read_count_and_lfn_variant.tsv
            optimize_lfn_variant_specific: test/utils/optimize_lfn_variant_specific.tsv
    params:
        is_optimize_lfn_variant_replicate: 0
        lfn_variant_or_variant_replicate_threshold: 0.001
        lfn_biosample_replicate_threshold: 0.001
        lfn_read_count_threshold: 10
        min_replicate_number: 2


rule OptimizeLFNreadCountAndLFNvariantReplicate:
    tool: vtam.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: test/utils/test_wopmars_runner_wopfile_optimize.py
            variant_known: test/utils/test_wopmars_runner_wopfile_optimize.py
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: test/utils/optimize_lfn_read_count_and_lfn_variant_replicate.tsv
            optimize_lfn_variant_specific: test/utils/optimize_lfn_variant_replicate_specific.tsv
    params:
        is_optimize_lfn_variant_replicate: 1
        lfn_variant_or_variant_replicate_threshold: 0.001
        lfn_biosample_replicate_threshold: 0.001
        lfn_read_count_threshold: 10
        min_replicate_number: 2