{% block footer %}

rule FilterMinReplicateNumber:
    tool: wopmetabarcoding.wrapper.FilterMinReplicateNumber
    input:
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            FilterLFN: wopmetabarcoding.model.FilterLFN
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            FilterMinReplicateNumber: wopmetabarcoding.model.FilterMinReplicateNumber
    params:
        min_replicate_number: {{min_replicate_number}}
#
rule FilterPCRError:
    tool: wopmetabarcoding.wrapper.FilterPCRError
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Variant: wopmetabarcoding.model.Variant
            FilterMinReplicateNumber: wopmetabarcoding.model.FilterMinReplicateNumber
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            FilterPCRError: wopmetabarcoding.model.FilterPCRError
    params:
        pcr_error_var_prop: {{pcr_error_var_prop}}
#
rule FilterChimera:
    tool: wopmetabarcoding.wrapper.FilterChimera
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Variant: wopmetabarcoding.model.Variant
            FilterPCRError: wopmetabarcoding.model.FilterPCRError
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            FilterChimera: wopmetabarcoding.model.FilterChimera
            FilterChimeraBorderline: wopmetabarcoding.model.FilterChimeraBorderline

rule FilterRenkonen:
    tool: wopmetabarcoding.wrapper.FilterRenkonen
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            FilterChimera: wopmetabarcoding.model.FilterChimera
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            FilterRenkonen: wopmetabarcoding.model.FilterRenkonen
    params:
        renkonen_threshold: {{renkonen_threshold}}

rule FilterIndel:
    tool: wopmetabarcoding.wrapper.FilterIndel
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Variant: wopmetabarcoding.model.Variant
            FilterRenkonen: wopmetabarcoding.model.FilterRenkonen
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            FilterIndel: wopmetabarcoding.model.FilterIndel

rule FilterCodonStop:
    tool: wopmetabarcoding.wrapper.FilterCodonStop
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Variant: wopmetabarcoding.model.Variant
            FilterIndel: wopmetabarcoding.model.FilterIndel
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            FilterCodonStop: wopmetabarcoding.model.FilterCodonStop
    params:
        genetic_table_number: {{genetic_table_number}}

rule ReadCountAverageOverReplicates:
    tool: wopmetabarcoding.wrapper.ReadCountAverageOverReplicates
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            FilterCodonStop: wopmetabarcoding.model.FilterCodonStop
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            ReadCountAverageOverReplicates: wopmetabarcoding.model.ReadCountAverageOverReplicates

rule TaxAssign:
    tool: wopmetabarcoding.wrapper.TaxAssign
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Variant: wopmetabarcoding.model.Variant
            FilterCodonStop: wopmetabarcoding.model.FilterCodonStop
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            TaxAssign: wopmetabarcoding.model.TaxAssign
    params:
        identity_threshold: {{identity_threshold}}
        include_prop: {{include_prop}}
        min_number_of_taxa: {{min_number_of_taxa}}


rule MakeOtuTable:
    tool: wopmetabarcoding.wrapper.MakeOtuTable
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Run: wopmetabarcoding.model.Run
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Variant: wopmetabarcoding.model.Variant
            FilterChimeraBorderline: wopmetabarcoding.model.FilterChimeraBorderline
            FilterCodonStop: wopmetabarcoding.model.FilterCodonStop
            TaxAssign: wopmetabarcoding.model.TaxAssign
        file:
            sample2fasta: {{fastainfo}}
    output:
        file:
            OTUTable: {{otutable}}

{% endblock %}
