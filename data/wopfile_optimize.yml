{% from 'macros.txt' import param_log %}{% extends "block_wopfile_asv_optimize.yml" %}
{% block wopfile_optimize %}rule OptimizeLFNbiosampleReplicate:
    tool: vtam.wrapper.OptimizeLFNbiosampleReplicate
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: {{fastainfo}}
            variant_known: {{variant_known}}
    output:
        file:
            optimize_lfn_biosample_replicate: {{optimize_lfn_biosample_replicate}}


rule OptimizePCRerror:
    tool: vtam.wrapper.OptimizePCRerror
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: {{fastainfo}}
            variant_known: {{variant_known}}
    output:
        file:
            optimize_pcr_error: {{optimize_pcr_error}}


rule OptimizeLFNreadCountAndLFNvariant:
    tool: vtam.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: {{fastainfo}}
            variant_known: {{variant_known}}
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: {{optimize_lfn_read_count_and_lfn_variant}}
            optimize_lfn_variant_specific: {{optimize_lfn_variant_specific}}
    params:
        is_optimize_lfn_variant_replicate: 0
        lfn_variant_or_variant_replicate_threshold: {{lfn_variant_threshold}}
        lfn_biosample_replicate_threshold: {{lfn_biosample_replicate_threshold}}
        lfn_read_count_threshold: {{lfn_read_count_threshold}}
        min_replicate_number: {{min_replicate_number}}


rule OptimizeLFNreadCountAndLFNvariantReplicate:
    tool: vtam.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: vtam.model.Run
            Marker: vtam.model.Marker
            Biosample: vtam.model.Biosample
            Replicate: vtam.model.Replicate
            Variant: vtam.model.Variant
            VariantReadCount: vtam.model.VariantReadCount
        file:
            fastainfo: {{fastainfo}}
            variant_known: {{variant_known}}
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: {{optimize_lfn_read_count_and_lfn_variant_replicate}}
            optimize_lfn_variant_specific: {{optimize_lfn_variant_replicate_specific}}
    params:
        is_optimize_lfn_variant_replicate: 1
        lfn_variant_or_variant_replicate_threshold: {{lfn_variant_replicate_threshold}}
        lfn_biosample_replicate_threshold: {{lfn_biosample_replicate_threshold}}
        lfn_read_count_threshold: {{lfn_read_count_threshold}}
        min_replicate_number: {{min_replicate_number}}{% endblock %}