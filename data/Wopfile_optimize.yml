rule SampleInformation:
    tool: wopmetabarcoding.wrapper.SampleInformation
    input:
        file:
            sample2fasta: {{fastainfo}}
    output:
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
            Fasta: wopmetabarcoding.model.Fasta
            PrimerPair: wopmetabarcoding.model.PrimerPair
            TagPair: wopmetabarcoding.model.TagPair
            SampleInformation: wopmetabarcoding.model.SampleInformation
    params:
        fasta_dir: {{fastadir}}

rule SortReads:
    tool: wopmetabarcoding.wrapper.SortReads
    input:
        table:
            Fasta: wopmetabarcoding.model.Fasta
            SampleInformation: wopmetabarcoding.model.SampleInformation
            Marker: wopmetabarcoding.model.Marker
        file:
            sample2fasta: {{fastainfo}}
    output:
        file:
            sortreads: {{sortreads}}
    params:
        min_id: {{min_id}}
        minseqlength: {{minseqlength}}
        overhang: {{overhang}}
#
rule VariantReadCount:
    tool: wopmetabarcoding.wrapper.VariantReadCount
    input:
        file:
            sortreads: {{sortreads}}
            sample2fasta: {{fastainfo}}
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            Replicate: wopmetabarcoding.model.Replicate
    output:
        table:
            Variant: wopmetabarcoding.model.Variant
            VariantReadCount: wopmetabarcoding.model.VariantReadCount


rule OptimizeLFNbiosampleReplicate:
    tool: wopmetabarcoding.wrapper.OptimizeLFNbiosampleReplicate
    input:
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            Variant: wopmetabarcoding.model.Variant
            VariantReadCount: wopmetabarcoding.model.VariantReadCount
        file:
            variant_known: {{variant_known}}
    output:
        file:
            optimize_lfn: {{optimize_lfn_biosample_replicate}}



rule OptimizePCRerror:
    tool: wopmetabarcoding.wrapper.OptimizePCRerror
    input:
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            VariantReadCount: wopmetabarcoding.model.VariantReadCount
            Variant: wopmetabarcoding.model.Variant
        file:
            variant_known: {{variant_known}}
    output:
        file:
            optimize_pcr_error: {{optimize_pcr_error}}


rule OptimizeLFNreadCountAndLFNvariant:
    tool: wopmetabarcoding.wrapper.OptimizeLFNreadCountAndLFNvariant
    input:
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            Variant: wopmetabarcoding.model.Variant
            VariantReadCount: wopmetabarcoding.model.VariantReadCount
        file:
            variant_known: {{variant_known}}
    params:
        lfn_variant_threshold: {{lfn_variant_threshold}}
        lfn_biosample_replicate_threshold: {{lfn_biosample_replicate_threshold}}
        lfn_read_count_threshold: {{lfn_read_count_threshold}}
        min_replicate_number: {{min_replicate_number}}
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant: {{optimize_lfn_read_count_and_lfn_variant}}
            optimize_lfn_variant_specific: {{optimize_lfn_variant_specific}}



rule OptimizeLFNreadCountAndLFNvariantReplicate:
    tool: wopmetabarcoding.wrapper.OptimizeLFNreadCountAndLFNvariantReplicate
    input:
        table:
            Run: wopmetabarcoding.model.Run
            Marker: wopmetabarcoding.model.Marker
            Biosample: wopmetabarcoding.model.Biosample
            Variant: wopmetabarcoding.model.Variant
            VariantReadCount: wopmetabarcoding.model.VariantReadCount
        file:
            variant_known: {{variant_known}}
    params:
        lfn_variant_replicate_threshold: {{lfn_variant_replicate_threshold}}
        lfn_biosample_replicate_threshold: {{lfn_biosample_replicate_threshold}}
        lfn_read_count_threshold: {{lfn_read_count_threshold}}
        min_replicate_number: {{min_replicate_number}}
    output:
        file:
            optimize_lfn_read_count_and_lfn_variant_replicate: {{optimize_lfn_read_count_and_lfn_variant_replicate}}
            optimize_lfn_variant_replicate_specific: {{optimize_lfn_variant_replicate_specific}}
