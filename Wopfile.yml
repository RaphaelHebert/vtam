rule SampleInformation:
    tool: wopmetabarcoding.wrapper.SampleInformation
    input:
        file:
            csv: data/1_sample_info.csv
    output:
        table:
            File: wopmetabarcoding.model.File
            SampleInformation: wopmetabarcoding.model.SampleInformation
            Marker: wopmetabarcoding.model.Marker
            PrimerPair: wopmetabarcoding.model.PrimerPair
            Biosample: wopmetabarcoding.model.Biosample
            TagPair: wopmetabarcoding.model.TagPair
            Replicate: wopmetabarcoding.model.Replicate

rule SortReads:
    tool: wopmetabarcoding.wrapper.SortReads
    input:
        table:
            File: wopmetabarcoding.model.File
            SampleInformation: wopmetabarcoding.model.SampleInformation
            Marker: wopmetabarcoding.model.Marker
    output:
        table:
            ReadCount: wopmetabarcoding.model.ReadCount
            Variant: wopmetabarcoding.model.Variant
    params:
        min_id: 0.8
        minseqlength: 32
        overhang: 0


rule Filter:
    tool: wopmetabarcoding.wrapper.Filter
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Variant: wopmetabarcoding.model.Variant
            Replicate: wopmetabarcoding.model.Replicate
        file:
            file_cutoff: data/cutoff_variant.tsv
            genetic_code: data/genetic_codes.csv
    output:
        file:
            filtered_dataframe_path: data/filtered_dataframe_path.tsv
    params:
        lfn_per_replicate_threshold: 0.001
        lfn_per_variant_threshold: 0.001
        lfn_per_replicate_series_threshold: 0.001
        lfn_read_count_threshold: 1
        repeatability_threshold: 2
        pcr_error_var_prop: 0.1
        renkonen_number_of_replicate: 3
        renkonen_renkonen_tail: 0.5
      


rule Taxassign:
    tool: wopmetabarcoding.wrapper.Taxassign
    input:
        table:
            Marker: wopmetabarcoding.model.Marker
            Variant: wopmetabarcoding.model.Variant
        file:
            filtered_dataframe_path: data/filtered_dataframe_path.tsv
            # Reference database fasta path
            taxassign_db_fasta: data/input/taxassign/Metazoa_BOLD_non_nt_2016_06_23.fas
            assignlvl2id: data/input/taxassign/assignlvl2id.tsv

